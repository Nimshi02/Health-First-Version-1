<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<script src="jquery.min.js"></script>
<link href="adminstylecss.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.input-field {
  width: 250px;
  padding: 10px;
  outline: none;
}

.input-field:focus {
  border: 2px solid dodgerblue;
}
a {
  color: white;
  text-decoration: none; /* no underline */
}
table, th, td {

  border: 1px solid black;
  
}
table{
align-self:center;
width:100%
}
table.center {
  margin-left: auto; 
  margin-right: auto;
}.border {
  border: none;
  margin-top: 560px;
}

.mr-0 {
  margin-right: auto;
}
.ml-auto {
  margin-left:690px;
}
.d-block {
  display:block;
}
.ml-up
{
	margin-top: auto;
}
</style>
<script>
var DID;
var PID;
var Day;
var token = sessionStorage.getItem('accessToken');
$(document).ready(function(){
	var url_string = window.location.href; 
	var url = new URL(url_string);
	 DID=url.searchParams.get("DID");
	PID=url.searchParams.get("PID");
	Day=url.searchParams.get("Date");
	
	var docid=null;
	var doccharges=null;
   $.ajax({ /* This AJAX function is to send the user details to the IS and get the id token */
   	type: "GET",
	        url: 'https://localhost:8243/dataservice/1.0.0/ViewAppointment?PID='+PID+'&DID='+DID+'&Date='+Day,
	        headers:{         
	        	'accept' :'*/*',
	            'Authorization' : 'Bearer '+token,
	            },
	          
	          
	          success: function(result, status, xhr){
	        	  DoctorDetails(result);
	    		  
		    },
			        error: function(error){
			  	      $("#div1").html("An error occured while creating a token to the user");
			        }
   	
	      
	});
	  });
function DoctorDetails(xml) {
    var i;
    var table =
        `<table><tbody><tr><th>DoctorID</th>
            <th>Patient ID</th>
            <th>Venue</th>
            <th>payment</th>
        </tr>`;
    var x = xml.getElementsByTagName("Entry");

    // Start to fetch the data by using TagName 
    for (i = 0; i < x.length; i++) {
        table += `<tr><td>` +
            x[i].getElementsByTagName("did")[0]
            .childNodes[0].nodeValue + `</td><td>` +
            x[i].getElementsByTagName("pid")[0]
            .childNodes[0].nodeValue + `</td><td>` +
            x[i].getElementsByTagName("venue")[0]
            .childNodes[0].nodeValue + `</td><td>`+
            x[i].getElementsByTagName("payment")[0]
            .childNodes[0].nodeValue + `</td></tr>`;
            
    }
    document.getElementById("div1").innerHTML =table;
}
$(document).ready(function(){
	  $("button").click(function(){
	    $.ajax({ 
	    	type: "GET",
		        url: 'https://localhost:8243/dataservice/1.0.0/UpdateConfirmation?PID='+PID+'&DID='+DID+'&Date='+Day,
		        headers:{         
		        	'accept' :'*/*',
		            'Authorization' : 'Bearer '+token,    
		        },
		       
	    	
	    	success: function(result, status, xhr){
	    		alert("success");
	    		location.href="Payment.html?DID="+DID+"&PID="+PID+"&Day="+Day;
	    },
		        error: function(error){
		  	      $("#div1").html("An error occured while deleting medical records. Please try again.");
		        }
		});
	  });
	});
</script>
</head>
<body>

<div id="div1"align="center">


 </div>
</div>


<p class="border">
 <button type="submit" class="btn d-block mr-0 ml-auto" style="background-color: #2d2c66;"><strong>Confirm Appointment<strong></button>
</p>
</body>
</html>